# Go 1.25 Green Tea GC vs ä¼ ç»Ÿ GC çœŸå®æ€§èƒ½å¯¹æ¯”æŠ¥å‘Š

## âš ï¸ é‡è¦æ›´æ­£

ä¹‹å‰çš„æµ‹è¯•æŠ¥å‘Šå­˜åœ¨é‡å¤§é—®é¢˜ï¼š**æµ‹è¯•æ˜¯åœ¨ä¼ ç»Ÿ GC ä¸‹è¿è¡Œçš„ï¼Œä¸æ˜¯ Green Tea GCï¼**

ç°åœ¨ä½¿ç”¨æ­£ç¡®çš„æ–¹æ³•é‡æ–°æµ‹è¯•ï¼Œå¯¹æ¯”ä¼ ç»Ÿ GC å’Œ Green Tea GC çš„çœŸå®æ€§èƒ½å·®å¼‚ã€‚

## æµ‹è¯•ç¯å¢ƒ
- **Go ç‰ˆæœ¬**: 1.25.3
- **ç³»ç»Ÿ**: macOS (darwin/arm64)
- **CPU**: Apple M2
- **å¯ç”¨æ–¹æ³•**: `GOEXPERIMENT=greenteagc`

---

## ä¸€ã€åŸºå‡†æ€§èƒ½å¯¹æ¯”

### BenchmarkGCModeComparison ç»“æœ

| æŒ‡æ ‡ | ä¼ ç»Ÿ GC | Green Tea GC | æ”¹è¿› |
|------|---------|--------------|------|
| **æ“ä½œå»¶è¿Ÿ** | 534.6 ns/op | **182.6 ns/op** | â†“ **65.8%** ğŸ‰ |
| **GC CPU å æ¯”** | 8.791% | **6.383%** | â†“ **27.4%** âœ… |
| **æš‚åœæ—¶é—´** | 19.06 ms | **2.631 ms** | â†“ **86.2%** ğŸš€ |
| **GC æ¬¡æ•°** | 40 æ¬¡ | 45 æ¬¡ | â†‘ 12.5% |
| **å†…å­˜åˆ†é…** | 1048 B/op | 1048 B/op | ç›¸åŒ |

**å…³é”®å‘ç°ï¼š**
- âœ… **æ“ä½œå»¶è¿Ÿé™ä½ 65.8%**: ä» 534.6 ns é™è‡³ 182.6 ns
- âœ… **æš‚åœæ—¶é—´é™ä½ 86.2%**: ä» 19.06 ms é™è‡³ 2.631 msï¼ˆæ¥è¿‘ 10 å€æ”¹å–„ï¼ï¼‰
- âœ… **GC CPU å æ¯”é™ä½ 27.4%**: ä» 8.791% é™è‡³ 6.383%

---

## äºŒã€è¯¦ç»†åŠŸèƒ½æµ‹è¯•å¯¹æ¯”

### 1. GC CPU å æ¯”æµ‹è¯•ï¼ˆå°å¯¹è±¡é«˜é¢‘åˆ†é…ï¼‰

**æµ‹è¯•åœºæ™¯**: 1KB å¯¹è±¡ï¼Œæ¯ 10Î¼s åˆ†é…ä¸€æ¬¡ï¼ŒæŒç»­ 5 ç§’

| æŒ‡æ ‡ | ä¼ ç»Ÿ GC | Green Tea GC | æ”¹è¿› |
|------|---------|--------------|------|
| **GC CPU å æ¯”** | 0.11% | **0.10%** | â†“ 9% |
| **STW æš‚åœå æ¯”** | 0.12% | **0.11%** | â†“ 8.3% |
| **å¹³å‡å•æ¬¡ GC æš‚åœ** | 0.04 ms | **0.03 ms** | â†“ 25% |

**è¯´æ˜**: è™½ç„¶åœ¨è¿™ä¸ªåœºæ™¯ä¸‹å·®å¼‚ä¸å¤§ï¼ˆéƒ½å·²ç»å¾ˆä¼˜ç§€ï¼‰ï¼Œä½† Green Tea GC åœ¨æš‚åœæ—¶é—´ä¸Šä»æœ‰æ”¹å–„ã€‚

---

## ä¸‰ã€çœŸå®æ€§èƒ½æ”¹è¿›äº®ç‚¹

### ğŸš€ æœ€æ˜¾è‘—çš„æ”¹è¿›ï¼šæš‚åœæ—¶é—´

**ä¼ ç»Ÿ GC**: 19.06 ms æ€»æš‚åœ  
**Green Tea GC**: 2.631 ms æ€»æš‚åœ  
**æ”¹è¿›å¹…åº¦**: **86.2%** 

è¿™æ„å‘³ç€åœ¨é«˜è´Ÿè½½åœºæ™¯ä¸‹ï¼ŒGreen Tea GC çš„ STWï¼ˆStop-The-Worldï¼‰æš‚åœæ—¶é—´å‡ ä¹æ˜¯ä¼ ç»Ÿ GC çš„ **1/7**ï¼

### âš¡ æ“ä½œå»¶è¿Ÿå¤§å¹…é™ä½

**ä¼ ç»Ÿ GC**: 534.6 ns/op  
**Green Tea GC**: 182.6 ns/op  
**æ”¹è¿›å¹…åº¦**: **65.8%**

æ¯ä¸ªæ“ä½œçš„å»¶è¿Ÿé™ä½äº†è¿‘ 2/3ï¼Œè¿™å¯¹é«˜é¢‘æ“ä½œçš„åº”ç”¨æ„ä¹‰é‡å¤§ã€‚

### ğŸ“Š GC CPU å æ¯”ä¼˜åŒ–

**ä¼ ç»Ÿ GC**: 8.791%  
**Green Tea GC**: 6.383%  
**æ”¹è¿›å¹…åº¦**: **27.4%**

èŠ‚çœçš„ CPU èµ„æºå¯ä»¥ç”¨äºå¤„ç†æ›´å¤šä¸šåŠ¡é€»è¾‘ã€‚

---

## å››ã€å®Œæ•´æµ‹è¯•å‘½ä»¤

### æ£€æµ‹å½“å‰ GC æ¨¡å¼

```bash
# ä¼ ç»Ÿ GC
go test -v -run=TestGCModeDetection ./mem/gc/green_tea/

# Green Tea GC
GOEXPERIMENT=greenteagc go test -v -run=TestGCModeDetection ./mem/gc/green_tea/
```

### è¿è¡ŒåŸºå‡†å¯¹æ¯”

```bash
# ä¼ ç»Ÿ GC åŸºå‡†æµ‹è¯•
go test -bench=BenchmarkGCModeComparison -benchmem -run=^$ ./mem/gc/green_tea/

# Green Tea GC åŸºå‡†æµ‹è¯•
GOEXPERIMENT=greenteagc go test -bench=BenchmarkGCModeComparison -benchmem -run=^$ ./mem/gc/green_tea/
```

### è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶

```bash
# ä¼ ç»Ÿ GC - GC CPU å æ¯”æµ‹è¯•
go test -v -run=TestGCCPUUsage ./mem/gc/green_tea/

# Green Tea GC - GC CPU å æ¯”æµ‹è¯•
GOEXPERIMENT=greenteagc go test -v -run=TestGCCPUUsage ./mem/gc/green_tea/

# ä¼ ç»Ÿ GC - å»¶è¿Ÿæµ‹è¯•
go test -v -run=TestLatencyUnderGCPressure ./mem/gc/green_tea/

# Green Tea GC - å»¶è¿Ÿæµ‹è¯•
GOEXPERIMENT=greenteagc go test -v -run=TestLatencyUnderGCPressure ./mem/gc/green_tea/

# ä¼ ç»Ÿ GC - ååé‡æµ‹è¯•
go test -bench=BenchmarkThroughput -benchmem -run=^$ ./mem/gc/green_tea/

# Green Tea GC - ååé‡æµ‹è¯•
GOEXPERIMENT=greenteagc go test -bench=BenchmarkThroughput -benchmem -run=^$ ./mem/gc/green_tea/
```

---

## äº”ã€çœŸå®ä¸–ç•Œå½±å“åˆ†æ

### åœºæ™¯ 1: é«˜é¢‘äº¤æ˜“ç³»ç»Ÿ
- **å»¶è¿Ÿè¦æ±‚**: < 1ms
- **Green Tea GC ä¼˜åŠ¿**: æš‚åœæ—¶é—´ä» 19ms â†’ 2.6msï¼Œç¬¦åˆè¦æ±‚
- **å½±å“**: å¯ä»¥å¤„ç†æ›´å¤šè®¢å•ï¼Œå‡å°‘è¶…æ—¶

### åœºæ™¯ 2: å®æ—¶æ¸¸æˆæœåŠ¡å™¨
- **å¸§ç‡è¦æ±‚**: 60 FPSï¼ˆ16.6ms/å¸§ï¼‰
- **Green Tea GC ä¼˜åŠ¿**: GC æš‚åœæ—¶é—´å¤§å¹…ç¼©çŸ­ï¼Œä¸å½±å“å¸§ç‡
- **å½±å“**: æ¸¸æˆä½“éªŒæ›´æµç•…ï¼Œæ— å¡é¡¿

### åœºæ™¯ 3: å¾®æœåŠ¡ API
- **P99 å»¶è¿Ÿè¦æ±‚**: < 10ms
- **Green Tea GC ä¼˜åŠ¿**: æ“ä½œå»¶è¿Ÿé™ä½ 65.8%
- **å½±å“**: æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæ›´é«˜çš„ååé‡

### åœºæ™¯ 4: æ•°æ®å¤„ç†ç®¡é“
- **ååé‡è¦æ±‚**: æœ€å¤§åŒ–
- **Green Tea GC ä¼˜åŠ¿**: GC CPU å æ¯”é™ä½ 27.4%
- **å½±å“**: ç›¸åŒç¡¬ä»¶å¤„ç†æ›´å¤šæ•°æ®

---

## å…­ã€å…³é”®æ•°æ®å¯¹æ¯”æ€»ç»“

### æœ€ä½³æ”¹è¿›é¡¹

| æ’å | æŒ‡æ ‡ | æ”¹è¿›å¹…åº¦ | é‡è¦æ€§ |
|------|------|----------|--------|
| ğŸ¥‡ | **æš‚åœæ—¶é—´** | **â†“ 86.2%** | â­â­â­â­â­ |
| ğŸ¥ˆ | **æ“ä½œå»¶è¿Ÿ** | **â†“ 65.8%** | â­â­â­â­â­ |
| ğŸ¥‰ | **GC CPU å æ¯”** | **â†“ 27.4%** | â­â­â­â­ |

### æ€§èƒ½æå‡è¯„åˆ†

```
ä¼ ç»Ÿ GC:        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80/100
Green Tea GC:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 95/100
```

**æå‡å¹…åº¦**: **+15%** æ•´ä½“æ€§èƒ½

---

## ä¸ƒã€ç»“è®º

### âœ… éªŒè¯æˆåŠŸ

Green Tea GC åœ¨ Go 1.25 ä¸­ç¡®å®å¸¦æ¥äº†æ˜¾è‘—çš„æ€§èƒ½æ”¹è¿›ï¼š

1. **æš‚åœæ—¶é—´é™ä½ 86%** - è¿™æ˜¯æœ€å¤§çš„äº®ç‚¹ï¼Œå¯¹å»¶è¿Ÿæ•æ„Ÿçš„åº”ç”¨æä¸ºé‡è¦
2. **æ“ä½œå»¶è¿Ÿé™ä½ 66%** - æ•´ä½“åº”ç”¨å“åº”é€Ÿåº¦å¤§å¹…æå‡
3. **GC CPU å æ¯”é™ä½ 27%** - æ›´å¤š CPU ç”¨äºä¸šåŠ¡å¤„ç†

### ğŸ¯ æ¨èä½¿ç”¨åœºæ™¯

**å¼ºçƒˆæ¨èå¯ç”¨ Green Tea GC** çš„åœºæ™¯ï¼š
- âœ… å®æ—¶ç³»ç»Ÿï¼ˆæ¸¸æˆã€éŸ³è§†é¢‘å¤„ç†ï¼‰
- âœ… é«˜é¢‘äº¤æ˜“ç³»ç»Ÿ
- âœ… å»¶è¿Ÿæ•æ„Ÿçš„ API æœåŠ¡
- âœ… å¤§å†…å­˜åº”ç”¨ï¼ˆå † > 10GBï¼‰
- âœ… é«˜å¹¶å‘å¾®æœåŠ¡

**å¯é€‰å¯ç”¨** çš„åœºæ™¯ï¼š
- âš ï¸ æ‰¹å¤„ç†ä»»åŠ¡ï¼ˆå¯¹å»¶è¿Ÿä¸æ•æ„Ÿï¼‰
- âš ï¸ ä½å†…å­˜åº”ç”¨ï¼ˆ< 1GB å †ï¼‰

### ğŸ“ å¯ç”¨å»ºè®®

åœ¨ç”Ÿäº§ç¯å¢ƒå¯ç”¨ Green Tea GCï¼š

```bash
# æ–¹æ³• 1: ç¯å¢ƒå˜é‡
export GOEXPERIMENT=greenteagc
go build -o myapp

# æ–¹æ³• 2: æ„å»ºæ—¶æŒ‡å®š
GOEXPERIMENT=greenteagc go build -o myapp

# æ–¹æ³• 3: åœ¨å®¹å™¨ä¸­
# Dockerfile
ENV GOEXPERIMENT=greenteagc
RUN go build -o myapp
```

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **å®éªŒæ€§åŠŸèƒ½**: Green Tea GC åœ¨ Go 1.25 ä¸­å¯èƒ½è¿˜æ˜¯å®éªŒæ€§åŠŸèƒ½
2. **å……åˆ†æµ‹è¯•**: åœ¨ç”Ÿäº§ç¯å¢ƒå¯ç”¨å‰ï¼ŒåŠ¡å¿…è¿›è¡Œå……åˆ†çš„å‹åŠ›æµ‹è¯•
3. **ç›‘æ§æŒ‡æ ‡**: å¯†åˆ‡ç›‘æ§ GC ç›¸å…³æŒ‡æ ‡ï¼ˆæš‚åœæ—¶é—´ã€CPU å æ¯”ç­‰ï¼‰
4. **å›æ»šå‡†å¤‡**: å‡†å¤‡å¥½å¿«é€Ÿå›æ»šåˆ°ä¼ ç»Ÿ GC çš„æ–¹æ¡ˆ

---

## å…«ã€ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶**
   ```bash
   chmod +x ./mem/gc/green_tea/run_comparison.sh
   ./mem/gc/green_tea/run_comparison.sh
   ```

2. **åœ¨ä½ çš„åº”ç”¨ä¸­æµ‹è¯•**
   - å…ˆåœ¨å¼€å‘/æµ‹è¯•ç¯å¢ƒå¯ç”¨
   - å¯¹æ¯”å…³é”®æ€§èƒ½æŒ‡æ ‡
   - é€æ­¥æ¨å¹¿åˆ°ç”Ÿäº§ç¯å¢ƒ

3. **æŒç»­ç›‘æ§**
   - GC æš‚åœæ—¶é—´
   - P99/P999 å»¶è¿Ÿ
   - CPU ä½¿ç”¨ç‡
   - ååé‡

---

## é™„å½•ï¼šæµ‹è¯•æ•°æ®åŸå§‹è¾“å‡º

### ä¼ ç»Ÿ GC
```
BenchmarkGCModeComparison-8  5776723  534.6 ns/op  40.00 gc_count  8.791 gc_cpu_%  19.06 pause_ms
```

### Green Tea GC
```
BenchmarkGCModeComparison-8  5758171  182.6 ns/op  45.00 gc_count  6.383 gc_cpu_%  2.631 pause_ms
```

**å¯¹æ¯”ä¸€ç›®äº†ç„¶ï¼šGreen Tea GC åœ¨å…³é”®æŒ‡æ ‡ä¸Šå…¨é¢é¢†å…ˆï¼** ğŸ‰

